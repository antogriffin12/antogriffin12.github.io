<!-- This HTML file provides a simple example of a portfolio page. It contains a header, a few sections, and a few charts. -->
<!-- It works with the three css files in this folder: example1.css, example2.css and example3.css. -->
<!-- The HTML file defines the structure of the page, and the CSS files define how it looks. -->
<!-- The CSS examples are all designed to work with this page. Try swapping them out on line 29 and see what happens. -->

<!-- Take a look around and make your own copy to adapt for your own use. -->

<!-- This is a comment -->
<!-- Comments are not displayed in the browser -->
<!-- They can be used to leave notes in the code -->

<!DOCTYPE html>
<html> 
    <!-- HTML is heirarchial: tags like this define elements on the page. 
    Each tag does something different. For example:
        - The <html> tag defines the whole document.
        - The <h1> tag defines a large heading
        - The <p> tag defines a paragraph
        - Tags appear as an opening <div> and closing </div> pair
    -->

<head>    
    <!-- The head tag links to resources our page needs and defines information about it. Tags in the <head> aren't displayed on the page. -->

    <!-- This is a link to a stylesheet which contains rules about how each element on the page should be defined-->
    <!-- Try swapping example1.css to another, and take a look at example1.css to see if you understand it-->
    <link rel="stylesheet" type="text/css" href="Example3.css">
    <title>My Portfolio</title> <!-- The title displayed in the browser tab, not on the page itself -->

    <!-- This is a link to the vega-lite which we're using to make graphs -->
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

    <style>
        #chartGrid {
            display: flex;
        }
        
    </style>
</head>

<body> 
<!-- The body tag contains the elements that visitors to our page will see. -->
    <h1 class="big" style="margin-bottom: 0px;"> <!-- We have added a class to the header called "big" which we can use to style it in the CSS -->
        <!-- This is a header, it is the largest text on the page -->
        Antonia Griffin
    </h1>
    <p style="margin-top: 0px; color: darkblue">
        <!-- we're setting the margin to 0px so the header and authour name are close together -->
        Antonia Griffin | <a href="https://www.linkedin.com/in/antonia-griffin-cuadra">LinkedIn</a> | <a
            href="https://www.github.com/antogriffin12">GitHub</a>| <a
            href="https://antogriffin12.github.io/Project/project.html">Project</a>
    </p>
    <h3 class="small"> <!-- We have added a class to the header called "small" which we can use to style it in the CSS -->
        This page acts as my portfolio of charts for Automated Data Visualisation for Policymaking (PP434) course.  
    </h3>

    <!-- We're organising the page into sections, with each section containing a chart, title and a description -->
    <section>
        <div class="chart-description">
            <h2>Section 1: Adding two graphs using vegaEmbed function</h2>
            <p> <!-- This is a paragraph, it's the main way to display text on a web page -->
                In this section I add two charts using the vegaEmbed function. Both graphs are from RDeconomist.github.io.<br>
                The first graph shows projected cumulative population changes from 2020 to 2100, with several countries, especially South Korea, Japan, Italy, Spain and France experiencing significant long-term declines. 
                In contrast, the United States and the United Kingdom are expected to maintain moderate population growth over the century.
            </p>
        </div>
        <figure id="Location1"></figure> <!-- we give it an id so we can put a vega-lite graph here with VegaEmbed -->
            <p> <!-- This is a paragraph, it's the main way to display text on a web page -->
                The second graph shows how different categories contribute to the UK CPIH consumer basket over time, with Housing & Utilities consistently making up the largest share at around 30%. Other categories such as Food, Transport, and Recreation fluctuate moderately, while items like Education, Hotels, and Communication remain relatively small and stable components of overall household spending.
        </div>
        <figure id="Location2"></figure> <!-- we give it an id so we can put a vega-lite graph here with VegaEmbed -->
    </section>

    <section>
        <div class="chart-description">
            <h2>Section 2: Creating my own visualisations</h2>
            <p> <!-- This is a paragraph, it's the main way to display text on a web page -->
                In this section I created two separate charts using the “create” tool in Economics Observatory Data Hub.
            <p>
                The first chart shows Japan's unemployment rate from 1992 to 2023, revealing a significant rise during the early 2000s when unemployment peaked at around 5.5%, followed by a gradual decline to approximately 2.5% by 2020. 
                This trend reflects Japan's economic recovery after the "Lost Decade" and its relatively stable labor market in recent years.
            </p>
        </div>
        <figure id="Location3"></figure> <!-- we give it an id so we can put a vega-lite graph here with VegaEmbed -->
            <p>
                The second chart displays the UK employment rate for people aged 16 and over from 1971 to 2023, showing a general upward trend from around 55% to over 60%. The data reveals periods of decline during economic recessions, particularly in the early 1980s and 1990s, but demonstrates overall improvement in labor market participation over the past five decades, with employment rates reaching historically high levels in recent years before the pandemic.
        </div>
        <figure id="Location4"></figure>
    </section>

    <section>
        <div class="chart-description">
            <h2>Section 3: Debate on pay-as-you-go pension systems in the United Kingdom</h2>
            <p> <!-- This is a paragraph, it's the main way to display text on a web page -->
                UK's pay-as-you-go pension system faces sustainability crisis: declining fertility reduces contributors while rising longevity increases beneficiaries and payment duration, demanding structural reform.
            </p>
        </div>
            <p>
                UK fertility fell from 2.2 to 1.6 births per woman (1950-2023), below replacement level, shrinking the future tax base funding current retirees.
            </p>

        <figure id="Location5"></figure> <!-- we give it an id so we can put a vega-lite graph here with VegaEmbed -->
            <p>
                Life expectancy rose from 69 to 81 years (1950-2023), meaning each pension must fund 12 additional retirement years, multiplying system costs.
            </p>
        </div>
        <figure id="Location6"></figure>  
            <p>
                Falling fertility and rising longevity strain pay-as-you-go pensions due to fewer contributors supporting more beneficiaries for extended periods, necessitating reform.
            </p>
    </section>
  

    <section>
        <div class="chart-description">
            <h2>Section 4: Replication and re-create, then improve someone else's chart.</h2>
            <p> <!-- This is a paragraph, it's the main way to display text on a web page -->
                I chose a ABC News graph: <a href= "https://web.archive.org/web/20241007071210/https://www.abc.net.au/news/2024-10-07/about-13-million-spare-bedrooms-in-australia-housing-crisis/104439670" target="_blank">ABC - Housing crisis chart</a>
            <p>   
                An image of it is:
            </p>
        <img src="ABC_graph.png" alt="Original Sports Capital Chart" style="max-width: 80%;">
        </div>
            <p> <!-- This is a paragraph, it's the main way to display text on a web page -->
                The replica chart:
            </p>
        <figure id="Location7"></figure> <!-- we give it an id so we can put a vega-lite graph here with VegaEmbed -->
        </div>
            <p> <!-- This is a paragraph, it's the main way to display text on a web page -->
                The improved bar-chart shows all states clearly (all states labeled, not hidden). Grouped bars enable clear comparison, sorted by size and with meaningful colors distinguish occupied/unoccupied housing.
            </p>
        <figure id="Location8"></figure> <!-- we give it an id so we can put a vega-lite graph here with VegaEmbed -->
        
    </section>   


    <section>
        <div class="chart-description">
            <h2>Section 5: Accessing data using Scraper and API.</h2>
            <p>
                This chart displays the crude death rate (deaths per 1,000 people) for Chile, United Kingdom, and OECD members from 1960 to 2023, using live data from the World Bank Indicators API.
            </p>
        </div>
        <figure id="Location9"></figure>
            <p>
                The base URL is: https://api.worldbank.org/v2/country/{country}/indicator/{indicator} <br>
                In which we need to specify some required elements:<br>
                1. Country codes (separated by semicolons for multiple countries):<br>
                - CHL = Chile<br>
                - GBR = United Kingdom<br>
                - OED = OECD members<br>
                2. Indicator code: SP.DYN.CDRT.IN = Death rate, crude (per 1,000 people)<br>
                3. Query parameters:<br>
                - format = json to specify JSON format for the response<br>
                - per_page = 3000 to increase the number of results returned per page (default is 50)<br>
                - date = 1960:2023 to filter data to specific date range<br>
                4. Data Format Specification in Vega-Lite: "format": {"property": "[1]"} tells Vega-Lite to access the data array at index [1] of the JSON response, as the World Bank API returns metadata in [0] and actual data in [1].<br>
                Using these elements, the final URL is:<br>
                https://api.worldbank.org/v2/country/CHL;GBR;OED/indicator/SP.DYN.CDRT.IN?format=json&per_page=3000&date=1960:2023
            </p>
            
        <div class="chart-description">
            <p>
                Now this second chart displays population data for Chile's 16 regions using data scraped from Wikipedia with Python and BeautifulSoup.
            </p>
        </div>
        <figure id="Location10"></figure>    
    
            <p>
                Source:<a href="https://es.wikipedia.org/wiki/Regiones_de_Chile" target="_blank">Wikipedia - Regions of Chile</a>
            </p>
    
            <p>
                Google Colab Notebook: <a href="https://colab.research.google.com/drive/1jvYDPlegiFytBB397CyBLYL44qWp0Hk8?usp=sharing" target="_blank">Colab Scraper Link</a> <br>
                The scraper:<br>
    
                1. Downloads the Wikipedia page containing Chile's regional data<br>
                2. Uses BeautifulSoup to identify and extract the wikitable containing region information<br>
                3. Removes citations, spaces, and formats numbers correctly (Chilean format uses spaces as thousands separators)<br>
                4. Converts data to TIDY/long format suitable for Vega-Lite visualisation<br>
                5. Saves cleaned data as JSON for direct use in charts
            </p>

            <p>
                The main challenge was that Wikipedia table headers contained citation markers (e.g., "Población(2024) [8]") that were removed during text cleaning, requiring dynamic column name matching. Additionally, Chilean number formatting uses spaces as thousands separators (e.g., "244 569") which required special handling in the data cleaning function.<br>
                The final dataset includes: region name, population (2024), area in km², population density (calculated), and capital city. Data is stored in TIDY format with each row representing one region and its associated attributes.
            </p>
        
    </section>   


    <section>
        <div class="chart-description">
            <h2>Section 6: Loops: Building a dashboard.</h2>
            <p> <!-- This is a paragraph, it's the main way to display text on a web page -->
                This dashboard demonstrates automated workflows using loops at two stages. First, I used a Python loop in Google Colab to batch-download life expectancy data from the World Bank API for six countries, saving each series as JSON on GitHub. Second, I used a JavaScript loop that iterates through country codes to dynamically generate all visualisations from a single code block. <br>
                Life expectancy has converged globally over six decades. In 1960, gaps exceeded 20 years between high and low-income countries; by 2023, differences narrowed to under 6 years. Japan leads at 84 years, while China shows the most dramatic transformation, rising from 33 years (1960) to 78 years (2023), reflecting rapid economic development and healthcare system expansion with significant implications for pension sustainability and demographic policy. <br>
                The link to my Loops Colab is: <a href= "https://colab.research.google.com/drive/13BMYnQFlWt-YUtnQb-TlV2dGrNgDKtK_?usp=sharing" target="_blank">Colab Loops Link</a>
            </p>
        </div>
        <div class="chart-grid">
            <div id="chart0"></div>
            <div id="chart1"></div>
            <div id="chart2"></div>
            <div id="chart3"></div>
            <div id="chart4"></div>
            <div id="chart5"></div>
        </div>

        <script type="text/javascript">
        const countries = [
            {code: 'GBR', name: 'United Kingdom'},
            {code: 'USA', name: 'United States'},
            {code: 'JPN', name: 'Japan'},
            {code: 'DEU', name: 'Germany'},
            {code: 'CHL', name: 'Chile'},
            {code: 'CHN', name: 'China'}
        ];  
        let baseSpec = {
            "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
            "title": {
                "text": "",
                "subtitle": "Source: World Bank (via Python API)",
                "anchor": "start"
            },
            "width": 280,
            "height": 200,
            "data": {"url": ""},
            "mark": {"type": "line", "color": "#58b3c7", "point": false},
            "encoding": {
                "x": {  
                    "field": "year",
                    "type": "quantitative", 
                    "title": "",
                    "axis": {"grid": false,
                    "format": "d"
                    }
                },
                "y": {
                    "field": "lifeExpectancy",
                    "type": "quantitative",
                    "title": "Life Expectancy (years)",
                    "axis": {"grid": false}
                },
                "tooltip": [
                    {"field": "country", "type": "nominal", "title": "Country"},
                    {"field": "year", "type": "ordinal", "title": "Year"},
                    {"field": "lifeExpectancy", "type": "quantitative", "title": "Life Expectancy", "format": ".2f"}
                ]
            }
        };

        countries.forEach((country, i) => {
            let spec = JSON.parse(JSON.stringify(baseSpec));
            spec.data.url = `https://raw.githubusercontent.com/antogriffin12/antogriffin12.github.io/refs/heads/main/Portafolio/life_expectancy_${country.code}.json`;
            spec.title.text = `Life Expectancy: ${country.name}`;
            vegaEmbed(`#chart${i}`, spec, {"renderer": "svg"});
        });
        </script>
        
    </section>   



    <section>
        <div class="chart-description">
            <h2>Section 7: Maps: Base maps and choropleths.</h2>
            <p> <!-- This is a paragraph, it's the main way to display text on a web page -->
                I chose to make a choropleth map of Wales showing an estimation of the average household income in 2023 at the Middle Layer Super Output Area (MSOA) level. The data was produced by the Office for National Statistics (ONS) using small area income estimates based on the Family Resources Survey. The link to the data source: <a href= "https://www.ons.gov.uk/peoplepopulationandcommunity/personalandhouseholdfinances/incomeandwealth/bulletins/smallareamodelbasedincomeestimates/financialyearending2023" target="_blank">Data Source ONS</a>
              
            </p>

        <figure id="Location12"></figure> <!-- we give it an id so we can put a vega-lite graph here with VegaEmbed -->
        <div>
            <p> <!-- This is a paragraph, it's the main way to display text on a web page -->
                I also created a coordinate map of Scotland showing the location of all schools, differentiated by school type (Primary, Secondary, and Special) and sized by pupil enrollment. The data was created by the Scottish Government and was last updated on 27 February 2025. The link to the data source: <a href= "https://www.data.gov.uk/dataset/9a6f9d86-9698-4a5d-a2c8-89f3b212c52c/scottish-school-roll-and-locations" target="_blank">Data Source Scottish Government</a>
            </p>
        <figure id="Location13"></figure> <!-- we give it an id so we can put a vega-lite graph here with VegaEmbed -->
        </div>
    </section>   


    <section>
        <div class="chart-description">
            <h2>Section 8: Big Data analysis in UK supermarket prices</h2>
            <p> <!-- This is a paragraph, it's the main way to display text on a web page -->
                Using the AutoCPI dataset of UK supermarket prices, I classified products into essential (milk, bread, eggs, rice, pasta) and non-essential (chocolate, crisps, sweets, ice cream) categories. I then aggregated daily prices by category to create a time-series comparison and analysed the last 30 days' price distribution. The link to the Colab Notebook: <a href= "https://colab.research.google.com/drive/1-aZeQGgZAF33CAxPNJnaGYG9YJ4ORQWZ?usp=sharing" target="_blank">Colab Big Data link</a>  <br>
                The first chart shows price evolution over time, revealing that non-essential products 
                consistently cost more.
            </p>
        <figure id="Location14"></figure>
            <p> <!-- This is a paragraph, it's the main way to display text on a web page -->
                The second chart displays the price distribution using box plots for the last 30 days of data, showing that non-essential products have higher median prices and greater price variability.
            </p>
        <figure id="Location15"></figure>
        </div>

    </section>  
    

    <section>
        <div class="chart-description">
            <h2>Section 9: Interactive Charts - Mortality Analysis in Chile</h2>
            <p> <!-- This is a paragraph, it's the main way to display text on a web page -->
                I created two interactive visualisations analysing mortality patterns across Chilean regions 
                from 2002-2022 using individual death records from DEIS (Departamento de Estadísticas e Información de Salud). 
                The dataset contains millions of records that were aggregated and combined with INE population data 
                to calculate mortality rates. <br>
                Mortality data: <a href="https://deis.minsal.cl/" target="_blank">DEIS - Ministerio de Salud de Chile</a><br>
                Population data: <a href="https://www.ine.cl/estadisticas/sociales/demografia-y-vitales/proyecciones-de-poblacion" target="_blank">INE Chile</a><br>
                The link to my Colab Notebook: <a href= "https://colab.research.google.com/drive/1UIt0oQVOUc5tmkMVg2n56xxsb3nOyWGN?usp=sharing" target="_blank">Colab Interactive charts link</a>  <br>
                The following choropleth map allows to explore how mortality rates evolved across Chilean regions 
                over two decades using a temporal slider. The visualisation reveals persistent health inequalities, 
                with southern regions generally showing higher mortality rates than northern regions. 
            </p>
        <figure id="Location16"></figure>
            <p> <!-- This is a paragraph, it's the main way to display text on a web page -->
                This line chart uses a dropdown menu to select regions and displays mortality trends by cause of death 
                (based on ICD-10 classification). The visualisation shows that circulatory diseases and tumors are 
                consistently the leading causes across all regions, though their relative importance varies. 
            </p>
        <figure id="Location17"></figure>
        </div>

    </section>


    <section>
        <div class="chart-description">
            <h2>Section 10: Advanced Analysis and Machine Learning</h2>
            <p> <!-- This is a paragraph, it's the main way to display text on a web page -->
                For the Advanced analytics task I wanted to check the hypothesis that COVID-19 created an unprecedented mortality shock in Chile, with excess deaths significantly exceeding pre-pandemic trends from 1994-2019.<br>
                I used a De-trended shock analysis using OLS regression on pre-pandemic baseline (1994-2019) to establish expected mortality trend, then calculating excess deaths during COVID-19 period (2020-2022). 
                Data source: DEIS Chile (N = 2,756,333 deaths). <br>
                The regression model: y = 1363.7x - 2,645,709.8 (R² = 0.960, p < 0.001). <br>
                The key findings are that Chile experienced 69,633 excess deaths during COVID-19 (2020-2022), representing a 21.0% increase above expected trends. The peak mortality occurred in 2021 with 27,254 excess deaths. <br>
                The link to the Google Colab Notebook is: <a href="https://colab.research.google.com/drive/158AXsTGy-VZ9ekz5KU2jLwmyoWwobDSL?usp=sharing" target="_blank">Colab Advanced Analytics Link</a>
            </p>
        <figure id="Location18"></figure>
            <p> <!-- This is a paragraph, it's the main way to display text on a web page -->
                For this task, I built a predictive model using Linear Regression to forecast life expectancy in Chile from socioeconomic factors. I accessed real-time data from World Bank APIs for GDP per capita, poverty rate, health and education expenditure (2000-2022). 
                The chart shows historical data and model predictions, achieving R²=0.916 with 0.23-year average error. Health expenditure emerged as the strongest predictor. <br>
                The Google Colab link: <a href="https://colab.research.google.com/drive/1pfNbusIAM47C-YxyQigYbjhIfuO4h4R6?usp=sharing" target="_blank">Colab Machine Learning link</a>
            </p>
        <figure id="Location19"></figure>
        </div>

    </section>

    
    <!-- Do you want to add more sections? -->
        <!-- Try copying pasting the section above -->
        <!-- You'll need to change the id of the figure "<figure id="Location3"... -->
        <!-- ... and add a new variable for the graph spec in the script at the bottom of the page -->


    <!-- This is a script, it's a way to run JavaScript code on the page -->
    <script>
        // This is a comment in JavaScript - it's a different language to HTML and CSS

        let figure_1_spec = "https://raw.githubusercontent.com/RDeconomist/RDeconomist.github.io/refs/heads/main/charts/e4e/chX_Maps/mapM1_GDP_global.json"; // We're storing the URL of the graph we want to display in a variable
        let figure_2_spec = "https://raw.githubusercontent.com/RDeconomist/RDeconomist.github.io/refs/heads/main/charts/productivity/chart_BSD9_SizeRLPdistribution.json"                                                                                                      // You should have a spec for a graph in this same folder. Just specify its name here, e.g. let figure_1_spec = "chart1.json"


        vegaEmbed('#Location1', figure_1_spec, {"renderer": "svg"}) // We're using the vegaEmbed function to put a graph in the element with id figure_1
        vegaEmbed('#Location2', figure_2_spec, {"renderer": "svg"})
        vegaEmbed('#Location3', "Japan.json", {"renderer": "svg"})
        vegaEmbed('#Location4', "UK_unemployment_rate.json", {"renderer": "svg"})
        vegaEmbed('#Location5', "UK_fertility.json", {"renderer": "svg"})
        vegaEmbed('#Location6', "UK_life_expectancy.json", {"renderer": "svg"})
        vegaEmbed('#Location7', "ABC_replica.json", {"renderer": "svg"})
        vegaEmbed('#Location8', "ABC_improved.json", {"renderer": "svg"})
        vegaEmbed('#Location9', "Mortality_rate.json", {"renderer": "svg"})
        vegaEmbed('#Location10', "Chile_regions_chart.json", {"renderer": "svg"})
        vegaEmbed('#Location11', "week8_milk_chart.json", {"renderer": "svg"})
        vegaEmbed('#Location12', "Wales_chart.json", {"renderer": "svg"})
        vegaEmbed('#Location13', "Scotland_schools.json", {"renderer": "svg"})
        vegaEmbed('#Location14', "chart1_bigdata.json", {"renderer": "svg"})
        vegaEmbed('#Location15', "chart2_bigdata.json", {"renderer": "svg"})
        vegaEmbed('#Location16', "Mortality_map_Chile.json", {"renderer": "svg"})
        vegaEmbed('#Location17', "Mortality_chart_cause_Chile.json", {"renderer": "svg"})
        vegaEmbed('#Location18', "Advanced_chart.json", {"renderer": "svg"})
        vegaEmbed('#Location19', "Machine_learning_chart.json", {"renderer": "svg"})

        console.log("0")
        console.log("1")

        let chart_spaces = [
            "https://raw.githubusercontent.com/RDeconomist/RDeconomist.github.io/refs/heads/main/charts/e4e/chX_Maps/mapM1_GDP_global.json",
            "https://raw.githubusercontent.com/RDeconomist/RDeconomist.github.io/refs/heads/main/charts/productivity/chart_BSD9_SizeRLPdistribution.json",
            "Japan.json",
            "UK_unemployment_rate.json",
            "New_chart.json",
            "shiller_pe_ratio_chart.json",
            "TRF_live_chart.json",
            "ABC_replica.json",
            "ABC_improved.json",
            "Mortality_rate.json",
            "Chile_regions_chart.json",
            "Wales_chart.json",
            "Scotland_schools.json",
            "chart1_bigdata.json",
            "chart2_bigdata.json",
            "Mortality_map_Chile.json",
            "Mortality_chart_cause_Chile.json",
            "Advanced_chart.json",
            "Machine_learning_chart.json"
        ]

        let chart_destinations = [
        "   #Location1",
            "#Location2",
            "#Location3",
            "#Location4",
            "#Location5", 
            "#Location6",
            "#Location7",
            "#Location8",
            "#Location9",
            "#Location10",
            "#Location11",
            "#Location12",
            "#Location13",
            "#Location14",
            "#Location15",
            "#Location16",
            "#Location17",
            "#Location18",
            "#Location19"
        ]

        for (let i = 0; i < 4; i = i+1) {
            console.log("CHART Spec at: "+chart_spaces[i])
            console.log("CHART destination at: "+chart_destinations[i])

        }


    </script>

</body>
    
</html>
